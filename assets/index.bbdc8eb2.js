import{r as m,c as n,j as e,F as U,M as V,d as g,I as q,p as C,q as v,B as H,t as K,E as Q,f as A,u as W,v as F,w as Y,x as X,y as J,a as Z,P as ee,z as M,_ as te}from"./vendor.100278bd.js";import{u as D,U as se,r as ae,c as R,E as h,I as E,d as ne,e as ie,f as le,L as ce,R as O,B as T}from"./index.1ccba7f9.js";const ue=a=>{const{items:l}=a,[s,c]=m.exports.useState(l[0].key),t=i=>{c(i)};return n("div",{className:"tabs",children:[e("div",{className:"tab-nav-list",children:l.map(({title:i,key:u})=>e("div",{className:`tabs-tab ${u===s?"tabs-tab-active":""}`,onClick:()=>t(u),children:i},u))}),e("div",{className:"tabs-content-list",children:l.map(({key:i,content:u})=>e("div",{className:`tabs-content-item ${i===s?"":"tabs-content-item-hidden"}`,children:u},i))})]})},re=["\u5927\u4E00","\u5927\u4E8C","\u5927\u4E09","\u5927\u56DB","\u7855\u58EB\u7814\u7A76\u751F","\u535A\u58EB\u7814\u7A76\u751F","\u5927\u5B66\u8001\u5E08","\u516C\u53F8\u6280\u672F\u5DE5\u7A0B\u5E08","\u5176\u4ED6"],_=[{value:"\u672A\u8BA2\u9605\u901A\u77E5",label:"\u4E0D\u8BA2\u9605\u901A\u77E5"},{value:"\u5DF2\u8BA2\u9605\u77ED\u4FE1\u901A\u77E5",label:"\u8BA2\u9605\u77ED\u4FE1\u901A\u77E5"},{value:"\u5DF2\u8BA2\u9605\u7535\u8BDD\u901A\u77E5",label:"\u8BA2\u9605\u7535\u8BDD\u901A\u77E5"},{value:"\u5DF2\u8BA2\u9605\u5168\u90E8\u901A\u77E5",label:"\u8BA2\u9605\u5168\u90E8\u901A\u77E5"}],oe=a=>{const[l]=g.useForm();return n(g,{form:l,className:"normal-form",onFinish:async c=>{let t={...c};t.status==2&&!t.name.endsWith("\u8001\u5E08")&&(t.name=t.name+"\u8001\u5E08"),t.status=t.status||1,t.phone=localStorage.getItem(se),t.clientId=a.courseInfo.clientId,t.courseId=a.courseInfo.courseId,t.uniCourseId=a.courseInfo.id,t.verify="1",t.classId=1;const i=await ae(t);a.onSubmit(i)},autoComplete:"off",size:"large",labelCol:{span:4},wrapperCol:{span:20},initialValues:{gender:"\u7537",tag:_[1].value},children:[e("h3",{children:"\u62A5\u540D"}),e(g.Item,{label:"\u59D3\u540D",name:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u59D3\u540D"}],children:e(q,{placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D"})}),e(g.Item,{label:"\u6027\u522B",name:"gender",children:n(C.Group,{children:[e(C,{value:"\u7537",children:"\u7537"}),e(C,{value:"\u5973",children:"\u5973"})]})}),e(g.Item,{label:"\u5E74\u7EA7",name:"age",children:e(v,{children:re.map(c=>e(v.Option,{value:c,children:c},c))})}),e(g.Item,{label:"\u5907\u6CE8",name:"tag",children:e(v,{children:_.map(({label:c,value:t})=>e(v.Option,{value:t,children:c},t))})}),e(g.Item,{wrapperCol:{span:24},children:e(H,{style:{width:"100%"},type:"primary",htmlType:"submit",children:"\u786E\u8BA4"})})]})},de=a=>{const[l,s]=m.exports.useState(a.defaultVisible),{state:{myRegisters:c},dispatch:t}=D();return n(U,{children:[e("button",{className:"btn",onClick:()=>s(!0),children:"\u7ACB\u5373\u62A5\u540D"}),e(V,{width:350,open:l,footer:null,onCancel:()=>s(!1),maskClosable:!1,children:e(oe,{onSubmit:u=>{var o;t({type:"UPDATE_MY_COURSES",payload:(c||[]).concat(u)}),(o=a.onRegisterCourse)==null||o.call(a,u),s(!1)},courseInfo:a.courseInfo})})]})};const L={2:"status-teacher.png",4:"status-ta.png",5:"status-admin.png"},me=a=>{const l=R();return K(a.data)?e("div",{className:"studentlist-wrap",children:e(Q,{})}):l!=null&&l.mobile()?e("div",{className:"list-mobile",children:A(a.data,(s,c)=>n("div",{className:"list-item",children:[e("div",{className:"list-item-index",children:c+1}),n("div",{className:"list-item-main-info",children:[n("div",{className:"info-name",children:[s.name,s.status!==h.STUDENT&&e("img",{height:"14",src:`img/${L[s.status]}`,alt:"student-status-png"})]}),e("div",{className:"info-other",children:n("span",{className:"current-bg",children:[e("span",{className:"list-item-label",children:"\u804C\u4E1A:"})," ",s.age]})})]}),e("div",{className:`list-item-gender ${s.gender==="\u5973"?"woman":"man"}`,children:s.gender==="\u5973"?e(E,{symbol:"icon-nv"}):e(E,{symbol:"icon-xingbienan"})}),e("div",{className:"list-item-tag",children:s.tag})]},s.id))}):e("div",{className:"list-wrap",children:n("table",{cellSpacing:"0",cellPadding:"0",children:[e("thead",{children:n("tr",{children:[e("th",{children:e("span",{children:"\u6635\u79F0"})}),e("th",{children:e("span",{children:"\u5E74\u7EA7"})}),e("th",{children:e("span",{children:"\u6027\u522B"})}),e("th",{children:e("span",{children:"\u5907\u6CE8"})})]})}),e("tbody",{children:A(a.data,(s,c)=>n("tr",{children:[n("td",{className:"lalign",children:[e("span",{className:"index",children:c+1}),n("span",{className:"student-name",children:[s.name,s.status!==h.STUDENT&&e("img",{height:"14",src:`img/${L[s.status]}`,alt:"student-status-png"})]})]}),e("td",{children:s.age}),e("td",{children:s.gender}),e("td",{children:s.tag})]},s.id))})]})})},he=["\u6559\u5BA4\u53F7","\u8BFE\u7A0B\u540D\u79F0","\u5F00\u59CB\u65F6\u95F4","\u4E0A\u8BFE\u5730\u70B9","\u5907\u6CE8","\u8BFE\u5802\u56DE\u653E"],pe=a=>{const l=R(),s=W(),c=async t=>s(`replay/${t.id}`);return l!=null&&l.mobile()?e("div",{className:"list-mobile",children:A(a.data,t=>n("div",{className:"list-item",onClick:()=>c(t),children:[n("div",{className:"list-item-main-info",children:[n("div",{className:"info-name",children:[t.className,e("span",{className:"location-tag",children:t.location})]}),n("div",{children:[e("span",{className:"list-item-label",children:"\u6559\u5BA4\u53F7:"})," ",t.roomId]}),n("div",{children:[e("span",{className:"list-item-label",children:"\u5F00\u59CB\u65F6\u95F4:"})," ",t.startAt]}),n("div",{children:[e("span",{className:"list-item-label",children:"\u5907\u6CE8:"})," ",t.remark]})]}),e("div",{className:"list-item-actions",children:e(E,{symbol:"icon-bofang"})})]},t.id))}):e("div",{className:"list-wrap",children:n("table",{cellSpacing:"0",cellPadding:"0",children:[e("thead",{children:e("tr",{children:he.map(t=>e("th",{children:e("span",{children:t})},t))})}),e("tbody",{children:A(a.data,(t,i)=>n("tr",{children:[n("td",{className:"lalign",children:[e("span",{className:"index",children:i+1}),t.roomId]}),e("td",{children:t.className}),e("td",{children:t.startAt}),e("td",{children:t.location}),e("td",{children:t.remark}),e("td",{children:e("span",{className:"player-btn",onClick:()=>c(t),children:e(E,{symbol:"icon-bofang"})})})]},t.id))})]})})};const k=a=>{const{state:{currentUser:l,myRegisters:s},dispatch:c}=D(),{id:t}=F(),i=m.exports.useRef(null),u=m.exports.useRef(null);let o="";if(l!=null&&l.phone){const r=M(s,d=>d.courseId===t);if(r){const d=encodeURIComponent(`pages/room/room?userId=${r.phone}-m&roomId=${a.courseInfo.roomId}&role=${O[r.status]||"student"}&username=${r.name}-m`);o=`${T}/seller/api/room/path.jpg?path=${d}`}else{const d=encodeURIComponent(`pages/index/index?roomId=${a.courseInfo.roomId}`);o=`${T}/seller/api/room/path.jpg?path=${d}`}}return m.exports.useEffect(()=>{if(u.current){const r=u.current,d=new XMLSerializer().serializeToString(r);i.current.src=`data:image/svg+xml;base64,${btoa(d)}`}},[u.current]),n(U,{children:[e(te,{ref:u,style:{display:"none",height:"auto",maxWidth:"100%",width:"100%"},value:window.location.href,fgColor:"#3db477",viewBox:"0 0 256 256"}),n("div",{className:"share-box",children:[n("span",{children:[e(E,{symbol:"icon-share"}),"\u5206\u4EAB\u4E8C\u7EF4\u7801"]}),e("span",{style:{marginBottom:10},children:"\u9080\u8BF7\u597D\u53CB\u52A0\u5165\u8BFE\u5802"}),n("div",{className:`share-imgs ${a.isMobile?"share-imgs-mobile":""}`,children:[e("img",{ref:i,alt:"share-course",className:"qr-code"}),o&&e("img",{src:o,alt:"mini"})]})]})]})},ge=a=>{const{state:{currentUser:l,myRegisters:s},dispatch:c}=D(),{id:t}=F(),i=()=>{c({type:"UPDATE_LOGIN_DIALOG_VISIBLE",payload:!0})},u=o=>{const{name:r,phone:d,status:B}=o,I=`https://room.loongsonedu.cn?username=${r}&userId=${d}&role=${O[B]||"student"}&roomId=${a.courseInfo.roomId}&video=${a.courseInfo.ishd||"480p"}`;window.open(I)};if(l!=null&&l.phone){const o=M(s,r=>r.courseId===t);return o?e("button",{className:"btn",onClick:()=>u(o),children:"\u5DF2\u62A5\u540D\uFF0C\u8FDB\u5165\u6559\u5BA4"}):e(de,{...a})}return e("button",{className:"btn",onClick:i,children:"\u767B\u5F55"})},fe=()=>{var x,y,S;const[a,l]=m.exports.useState({}),[s,c]=m.exports.useState([]),t=R(),i=m.exports.useRef({}),[u,o]=m.exports.useState(!0),{id:r}=F(),d=m.exports.useCallback(async()=>{if(r){const f=await ne(r),P=await ie(r),b=Y(P,"status"),w=b[h.TEACHER]||[],j=b[h.TUTOR]||[],z=b[h.ADMIN]||[];let N=[];X(b).filter(p=>![h.TEACHER,h.TUTOR,h.ADMIN].includes(p)).forEach(p=>{N=N.concat(b[p])}),i.current.applyStudents=N,i.current.teacher=J(w);const G=w.concat(j,z,N);c(G),i.current.if_teacher=!i.current.teacher;const $=await le(r);i.current.replayList=$,i.current.validReplayList=Z($.filter(({status:p})=>p==1)||[],p=>p.startAt),l(f),o(!1)}},[r]);if(m.exports.useEffect(()=>{d()},[d]),u)return e(ce,{});const B=[{key:"intro",title:"\u8BFE\u7A0B\u4ECB\u7ECD",content:e("div",{dangerouslySetInnerHTML:{__html:a.introduction}})},{key:"student",title:`\u62A5\u540D\u6210\u5458(${(s==null?void 0:s.length)||0})`,content:e(me,{data:s})},{key:"replay",title:`\u8BFE\u5802\u56DE\u653E(${(x=i.current.validReplayList)==null?void 0:x.length})`,content:e(pe,{data:i.current.validReplayList})}],I=f=>{c((s||[]).concat(f)),i.current.applyStudents=(i.current.applyStudents||[]).concat(f)};return n("div",{className:"course-detail-wrapper",children:[n("section",{className:"main-content",children:[e("img",{src:a.coverUrl,alt:"coverUrl",className:"course-cover"}),n("div",{className:"course-main-info",children:[e("div",{className:"course-title",children:a.title}),n("div",{className:"course-info",children:[n("div",{className:"course-info-item",children:[e("span",{className:"course-info-item-label",children:"\u4EFB\u8BFE\u6559\u5E08: "}),(y=i.current.teacher)==null?void 0:y.name]}),n("div",{className:"course-info-item",children:[e("span",{className:"course-info-item-label",children:"\u5B66\u751F\u4EBA\u6570: "}),(S=i.current.applyStudents)==null?void 0:S.length," \u4EBA"]})]}),n("div",{className:"course-actions",children:[n("div",{className:"course-price",children:["\xA5 ",a.price]}),e(ge,{courseInfo:a,onRegisterCourse:I})]})]}),t!=null&&t.mobile()?e(ee,{placement:"leftTop",content:e(k,{courseInfo:a,isMobile:!0}),trigger:"click",children:e("span",{className:"share-icon",children:e(E,{symbol:"icon-share"})})}):e("div",{className:"share-area",children:e(k,{courseInfo:a})})]}),e("section",{className:"course-intro",children:e(ue,{items:B})})]})};export{fe as default};
